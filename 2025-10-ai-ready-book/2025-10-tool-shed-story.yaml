apiStory:
  title: Tool Shed Sharing Program
  purpose: Members can borrow tools from the shared tool shed, similar to checking out books from a library.

  properties:
    - name: toolId
      type: string
      description: Unique identifier for each tool in the shed.

    - name: toolName
      type: string
      description: The common name of the tool.

    - name: toolType
      type: string
      description: Category or type of the tool (e.g., drill, saw, wrench).

    - name: condition
      type: enum
      enum: [new, good, worn, broken]
      description: Current condition of the tool.

    - name: memberId
      type: string
      description: Unique identifier for each registered member.

    - name: memberName
      type: string
      description: The name of the member borrowing or returning a tool.

    - name: membershipStatus
      type: enum
      enum: [active, suspended, expired]
      description: Current status of the member’s account.

    - name: borrowDate
      type: date
      description: Date when a member borrows a tool.

    - name: dueDate
      type: date
      description: Expected date when the borrowed tool should be returned.

    - name: returnDate
      type: date
      description: Date when the borrowed tool is actually returned.

    - name: isOverdue
      type: boolean
      description: Indicates whether the tool is overdue for return.

    - name: maxBorrowDays
      type: number
      description: Maximum number of days a tool may be borrowed.

    - name: depositRequired
      type: boolean
      description: Indicates whether the tool requires a refundable deposit.

  resources:
    - name: Home
      description: The starting point for the API, offering entry to members and tools.
      actions: [viewTools, viewMembers, viewSharings]

    - name: ToolCollection
      description: A list of all tools available in the shed.
      actions: [viewTool, addTool]

    - name: ToolItem
      description: Details for a single tool, including condition and availability.
      actions: [updateTool]

    - name: MemberCollection
      description: A list of all registered members.
      actions: [viewMember, addMember]

    - name: MemberItem
      description: Details for a single member, including borrowing history and status.
      actions: [updateMember, suspendMember, activateMember]

    - name: SharingCollection
      description: A record of all borrowing transactions between members and tools.
      actions: [createSharing, viewSharing]

    - name: SharingItem
      description: Details of a single borrowing transaction.
      actions: [closeSharing]

  actions:
    # Home-level navigation
    - name: viewTools
      type: Safe
      inputs: []
      returns: ToolCollection

    - name: viewMembers
      type: Safe
      inputs: []
      returns: MemberCollection

    - name: viewSharings
      type: Safe
      inputs: []
      returns: SharingCollection

    # Tool actions
    - name: addTool
      type: Unsafe
      inputs:
        - name: toolName
          required: true
        - name: toolType
          required: true
        - name: condition
          required: true
      returns: ToolItem

    - name: viewTool
      type: Safe
      inputs:
        - name: toolId
          required: true
      returns: ToolItem

    - name: updateTool
      type: Idempotent
      inputs:
        - name: toolId
          required: true
        - name: condition
          required: false
      returns: ToolItem

    # Member actions
    - name: addMember
      type: Unsafe
      inputs:
        - name: memberName
          required: true
      returns: MemberItem

    - name: viewMember
      type: Safe
      inputs:
        - name: memberId
          required: true
      returns: MemberItem

    - name: updateMember
      type: Idempotent
      inputs:
        - name: memberId
          required: true
        - name: membershipStatus
          required: false
      returns: MemberItem

    - name: suspendMember
      type: Idempotent
      inputs:
        - name: memberId
          required: true
      returns: MemberItem

    - name: activateMember
      type: Idempotent
      inputs:
        - name: memberId
          required: true
      returns: MemberItem

    # Sharing actions
    - name: createSharing
      type: Unsafe
      inputs:
        - name: memberId
          required: true
        - name: toolId
          required: true
        - name: borrowDate
          required: true
        - name: dueDate
          required: true
      returns: SharingItem
      rules: [MemberMustBeActive, ToolMustBeAvailable]

    - name: viewSharing
      type: Safe
      inputs:
        - name: sharingId
          required: true
      returns: SharingItem

    - name: closeSharing
      type: Idempotent
      inputs:
        - name: sharingId
          required: true
        - name: returnDate
          required: true
      returns: SharingItem
      rules: [ToolConditionUpdateRequired]

  rules:
    - name: MemberMustBeActive
      description: A tool may only be borrowed by a member whose membershipStatus is active.

    - name: ToolMustBeAvailable
      description: A tool can only be borrowed if it is not currently part of an open sharing record.

    - name: ToolConditionUpdateRequired
      description: When a sharing record is closed, the tool’s condition must be reviewed and updated before it can be borrowed again.

